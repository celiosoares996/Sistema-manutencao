<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Manutenção - KMC2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen font-sans">

    <nav class="bg-slate-800 p-4 text-white shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-wider text-blue-400">KMC2 <span class="text-white">| Tech</span></h1>
            <span id="data-atual" class="text-sm opacity-75"></span>
        </div>
    </nav>

    <div class="container mx-auto p-6">
        <div id="menu-container" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <button onclick="abrirModulo('email')" class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition-all border-b-4 border-orange-500 flex flex-col items-center gap-3">
                <i class="fas fa-envelope-open-text text-3xl text-orange-500"></i>
                <span class="font-bold text-gray-700">Gerar E-mail</span>
            </button>

            <button onclick="abrirModulo('manutencao')" class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition-all border-b-4 border-blue-500 flex flex-col items-center gap-3">
                <i class="fas fa-tools text-3xl text-blue-500"></i>
                <span class="font-bold text-gray-700">Nova Manutenção</span>
            </button>

            <button onclick="abrirModulo('relatorio')" class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition-all border-b-4 border-green-500 flex flex-col items-center gap-3">
                <i class="fas fa-chart-line text-3xl text-green-500"></i>
                <span class="font-bold text-gray-700">Relatórios</span>
            </button>
        </div>

        <div id="modulo-email" class="hidden bg-white p-8 rounded-xl shadow-lg max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                <i class="fas fa-paper-plane text-orange-500"></i> Redigir E-mail
            </h2>
            <div class="space-y-4">
                <input type="text" id="nome-cliente-email" placeholder="Nome do Cliente" class="w-full p-3 border rounded-lg outline-none focus:ring-2 focus:ring-orange-400">
                <input type="text" id="servico-realizado" placeholder="Serviço Realizado (ex: Formatação)" class="w-full p-3 border rounded-lg outline-none focus:ring-2 focus:ring-orange-400">
                <textarea id="resultado-email" readonly class="w-full p-4 bg-gray-50 border rounded-lg h-40 text-sm text-gray-600 italic"></textarea>
                <div class="flex gap-2">
                    <button onclick="gerarTextoEmail()" class="flex-1 bg-orange-500 text-white font-bold py-3 rounded-lg hover:bg-orange-600 transition">Gerar Texto</button>
                    <button onclick="copiarEmail()" class="bg-gray-200 px-6 rounded-lg hover:bg-gray-300"><i class="fas fa-copy"></i></button>
                </div>
            </div>
        </div>

        <div id="modulo-manutencao" class="hidden bg-white p-8 rounded-xl shadow-lg max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                <i class="fas fa-plus-circle text-blue-500"></i> Registrar Manutenção
            </h2>
            <form id="registro-form" class="space-y-4">
                <input type="email" id="email-cliente" required placeholder="E-mail da Máquina/Cliente" class="w-full p-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="valor-total" value="50.00" step="0.01" class="p-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="date" id="data-servico" class="p-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition">Salvar no Histórico</button>
            </form>
        </div>

        <div id="modulo-relatorio" class="hidden bg-white p-8 rounded-xl shadow-lg">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800 uppercase tracking-tight text-sm">Histórico Mensal</h2>
                <input type="month" id="filtro-mes" onchange="carregarTabela()" class="p-2 border rounded-lg text-sm">
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr class="bg-gray-50 text-gray-500 text-xs uppercase">
                            <th class="p-4">Data</th>
                            <th class="p-4">Máquina</th>
                            <th class="p-4">Serviço</th>
                            <th class="p-4">Taxa</th>
                            <th class="p-4">Total</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-corpo" class="text-sm"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- NAVEGAÇÃO ---
        function abrirModulo(id) {
            ['modulo-email', 'modulo-manutencao', 'modulo-relatorio'].forEach(m => {
                document.getElementById(m).classList.add('hidden');
            });
            document.getElementById('modulo-' + id).classList.remove('hidden');
            if(id === 'relatorio') carregarTabela();
        }

        // --- GERADOR DE EMAIL ---
        function gerarTextoEmail() {
            const nome = document.getElementById('nome-cliente-email').value || "Cliente";
            const servico = document.getElementById('servico-realizado').value || "Manutenção";
            const texto = `Olá ${nome},\n\nInformamos que o serviço de "${servico}" em sua máquina foi concluído com sucesso e já está disponível para retirada.\n\nValor total: R$ 50,00 (Taxa de serviço inclusa).\n\nAtenciosamente,\nEquipe KMC2`;
            document.getElementById('resultado-email').value = texto;
        }

        function copiarEmail() {
            const areaTexto = document.getElementById('resultado-email');
            areaTexto.select();
            document.execCommand('copy');
            alert("Texto copiado!");
        }

        // --- LÓGICA DE DADOS ---
        document.getElementById('data-servico').valueAsDate = new Date();
        document.getElementById('data-atual').innerText = new Date().toLocaleDateString('pt-br');

        const form = document.getElementById('registro-form');
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const total = parseFloat(document.getElementById('valor-total').value);
            const taxa = total * 0.0909; 
            const registro = {
                email: document.getElementById('email-cliente').value,
                total: total.toFixed(2),
                taxa: taxa.toFixed(2),
                servico: (total - taxa).toFixed(2),
                data: document.getElementById('data-servico').value
            };
            const lista = JSON.parse(localStorage.getItem('kmc2_dados') || '[]');
            lista.push(registro);
            localStorage.setItem('kmc2_dados', JSON.stringify(lista));
            alert('Salvo com sucesso!');
            form.reset();
        });

        function carregarTabela() {
            const corpo = document.getElementById('tabela-corpo');
            const lista = JSON.parse(localStorage.getItem('kmc2_dados') || '[]');
            corpo.innerHTML = lista.map(m => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="p-4">${m.data.split('-').reverse().join('/')}</td>
                    <td class="p-4 font-medium">${m.email}</td>
                    <td class="p-4 text-gray-500">R$ ${m.servico}</td>
                    <td class="p-4 text-orange-500">R$ ${m.taxa}</td>
                    <td class="p-4 font-bold text-blue-600">R$ ${m.total}</td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>
