<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Manutenção - KMC2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen font-sans">

    <nav class="bg-blue-600 p-4 text-white shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-wider">KMC2 | Service Manager</h1>
            <span id="data-atual" class="text-sm"></span>
        </div>
    </nav>

    <div class="container mx-auto p-6">
        <div id="menu-container" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <button onclick="abrirModulo('manutencao')" class="bg-white p-6 rounded-xl shadow-md hover:shadow-xl transition-all border-l-4 border-blue-500 flex items-center justify-between group">
                <div>
                    <h3 class="text-lg font-bold text-gray-700 group-hover:text-blue-600">Nova Manutenção</h3>
                    <p class="text-sm text-gray-500">Registrar serviço e calcular taxa</p>
                </div>
                <i class="fas fa-tools text-3xl text-blue-500"></i>
            </button>

            <button onclick="abrirModulo('relatorio')" class="bg-white p-6 rounded-xl shadow-md hover:shadow-xl transition-all border-l-4 border-green-500 flex items-center justify-between group">
                <div>
                    <h3 class="text-lg font-bold text-gray-700 group-hover:text-green-600">Relatórios / Filtros</h3>
                    <p class="text-sm text-gray-500">Consultar histórico e mensal</p>
                </div>
                <i class="fas fa-file-invoice-dollar text-3xl text-green-500"></i>
            </button>
        </div>

        <div id="form-manutencao" class="hidden bg-white p-8 rounded-xl shadow-lg max-w-2xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Registrar Manutenção</h2>
                <button onclick="fecharModulos()" class="text-gray-400 hover:text-red-500"><i class="fas fa-times"></i></button>
            </div>
            
            <form id="registro-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-600">E-mail do Cliente / Máquina</label>
                    <input type="email" id="email-cliente" required class="w-full mt-1 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="exemplo@cliente.com">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-600">Valor Total (R$)</label>
                        <input type="number" id="valor-total" value="50.00" step="0.01" class="w-full mt-1 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-600">Data do Serviço</label>
                        <input type="date" id="data-servico" class="w-full mt-1 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-sm text-blue-700">O sistema calculará automaticamente a taxa inclusa.</p>
                </div>

                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition">Salvar Manutenção</button>
            </form>
        </div>

        <div id="secao-relatorio" class="hidden bg-white p-8 rounded-xl shadow-lg">
            <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-gray-800">Histórico de Serviços</h2>
                <div class="flex gap-2">
                    <input type="month" id="filtro-mes" class="p-2 border rounded-lg">
                    <button onclick="gerarRelatorioMensal()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Gerar Mensal</button>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-100 text-gray-600 uppercase text-xs font-bold">
                            <th class="p-4 border-b">Data</th>
                            <th class="p-4 border-b">E-mail/Máquina</th>
                            <th class="p-4 border-b">Serviço</th>
                            <th class="p-4 border-b">Taxa</th>
                            <th class="p-4 border-b">Total</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-corpo">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Lógica de Navegação
        function abrirModulo(modulo) {
            document.getElementById('form-manutencao').classList.add('hidden');
            document.getElementById('secao-relatorio').classList.add('hidden');
            
            if(modulo === 'manutencao') document.getElementById('form-manutencao').classList.remove('hidden');
            if(modulo === 'relatorio') {
                document.getElementById('secao-relatorio').classList.remove('hidden');
                carregarTabela();
            }
        }

        function fecharModulos() {
            document.getElementById('form-manutencao').classList.add('hidden');
            document.getElementById('secao-relatorio').classList.add('hidden');
        }

        // Preencher data atual por padrão
        document.getElementById('data-servico').valueAsDate = new Date();
        document.getElementById('data-atual').innerText = new Date().toLocaleDateString('pt-br');

        // Lógica de Armazenamento (LocalStorage para agora)
        const form = document.getElementById('registro-form');
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const valorTotal = parseFloat(document.getElementById('valor-total').value);
            const taxa = valorTotal * 0.0909; // Para que 50,00 seja o total final
            const valorServico = valorTotal - taxa;

            const novaManutencao = {
                email: document.getElementById('email-cliente').value,
                valorTotal: valorTotal.toFixed(2),
                taxa: taxa.toFixed(2),
                servico: valorServico.toFixed(2),
                data: document.getElementById('data-servico').value
            };

            // Salvar no "Banco de Dados" do navegador
            const historico = JSON.parse(localStorage.getItem('manutencoes') || '[]');
            historico.push(novaManutencao);
            localStorage.setItem('manutencoes', JSON.stringify(historico));

            alert('Manutenção salva com sucesso!');
            form.reset();
            document.getElementById('data-servico').valueAsDate = new Date();
        });

        function carregarTabela() {
            const corpo = document.getElementById('tabela-corpo');
            const historico = JSON.parse(localStorage.getItem('manutencoes') || '[]');
            
            corpo.innerHTML = historico.map(m => `
                <tr class="hover:bg-gray-50 text-gray-700">
                    <td class="p-4 border-b">${new Date(m.data).toLocaleDateString('pt-br')}</td>
                    <td class="p-4 border-b">${m.email}</td>
                    <td class="p-4 border-b text-blue-600">R$ ${m.servico}</td>
                    <td class="p-4 border-b text-orange-600">R$ ${m.taxa}</td>
                    <td class="p-4 border-b font-bold">R$ ${m.valorTotal}</td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>
